
# WebSocket API Спецификация

## Введение

Данный документ описывает спецификацию WebSocket API для взаимодействия с игровым сервером. API позволяет пользователям подключаться к серверу, аутентифицироваться, обновлять состояние игровых элементов и получать текущее состояние игрового поля.

## Установление соединения

Для начала взаимодействия с сервером клиент должен установить WebSocket соединение по следующему адресу:

```
ws://<server_address>/
```

После установления соединения клиент должен аутентифицироваться, отправив свои учетные данные.

## Аутентификация

### Запрос клиента

Для аутентификации клиент отправляет JSON объект с следующими полями:

```json
{
  "nickname": "<nickname>",
  "user_id": "<user_id>"
}
```

- `nickname` - псевдоним пользователя.
- `user_id` - идентификатор пользователя (опционально).

### Ответ сервера

#### Успешная аутентификация

Если пользователь успешно аутентифицирован, сервер отправляет JSON объект:

```json
{
  "type": "user_id",
  "data": "<user_id>"
}
```

- `user_id` - идентификатор пользователя, который может быть использован для дальнейшей аутентификации.

#### Ошибка аутентификации

В случае ошибки аутентификации сервер может отправить один из следующих ответов:

- Пользователь забанен:

  ```json
  {
    "type": "banned"
  }
  ```

- Пользователь не найден или неверный `nickname`:

  ```json
  {
    "type": "error",
    "message": "User not found or invalid nickname"
  }
  ```

## Обновление пикселя

### Запрос клиента

Для обновления пикселя клиент отправляет следующий JSON объект:

```json
{
  "type": "update_pixel",
  "data": {
    "x": <x_coord>,
    "y": <y_coord>,
    "color": "<color_code>",
    "action_time": "<timestamp>"
  }
}
```

- `x` и `y` - координаты пикселя на игровом поле.
- `color` - цвет пикселя в HEX формате.
- `action_time` - временная метка действия в формате ISO 8601.

### Ответ сервера

Сервер не отправляет прямой ответ на это действие, но обновленное состояние поля будет включено в следующее сообщение с состоянием поля, отправленное всем подключенным клиентам.

## Получение состояния поля

### Запрос клиента

Для получения текущего состояния игрового поля клиент отправляет JSON объект:

```json
{
  "type": "get_field_state"
}
```

### Ответ сервера

Сервер отправляет состояние игрового поля в следующем формате:


### Ответ сервера

```json
{
  "type": "field_state",
  "data": [
    {
      "x": 10,
      "y": 20,
      "color": "#FF5733",
      "user_id": "d6e441ad-ca6e-4bc7-bc09-b6da205587ec"
    }
  ]
}
```

- Каждый объект в массиве `data` представляет собой пиксель с указанием его координат (`x`, `y`), цвета (`color`) и идентификатора пользователя (`user_id`), который его обновил.

## Отключение

### Запрос клиента

Клиент может явно запросить отключение, отправив сообщение:

```json
{
  "type": "disconnect"
}
```

### Ответ сервера

Сервер подтверждает отключение и закрывает соединение, отправив код закрытия 1000 (Normal Closure).

## Обработка ошибок

В случае возникновения ошибки при обработке запроса сервер может отправить сообщение об ошибке:

```json
{
  "type": "error",
  "message": "<error_message>"
}
```

---

На основе предоставленных результатов тестов, документацию можно дополнить следующими деталями:

---

## Онлайн счетчик

После успешной аутентификации сервер отправляет всем подключенным клиентам информацию о количестве онлайн пользователей:

### Ответ сервера

```json
{
  "type": "online_count",
  "data": {
    "online": <number_of_online_users>
  }
}
```

- `<number_of_online_users>` - количество пользователей, в данный момент подключенных к серверу.
